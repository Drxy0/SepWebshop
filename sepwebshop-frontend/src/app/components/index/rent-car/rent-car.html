<div *ngIf="selectedCar">
  <h2 class="text-2xl font-bold text-gray-900 mb-2 border-b pb-4">Booking Details</h2>

  <div
    class="bg-blue-50 rounded-2xl p-4 mb-6 mt-4 flex justify-between items-center border border-blue-100"
  >
    <div>
      <p class="text-xs font-bold text-blue-400 uppercase">Selected Vehicle</p>
      <p class="text-lg font-bold text-blue-900">{{ selectedCar.brandAndModel }}</p>
    </div>
    <div class="text-right">
      <p class="text-xs font-bold text-blue-400 uppercase">Daily Price</p>
      <p class="text-lg font-bold text-blue-900">{{ selectedCar.price }} din</p>
    </div>
  </div>

  <form [formGroup]="rentForm" (ngSubmit)="confirmBooking()" class="space-y-5">
    <div class="grid grid-cols-2 gap-4">
      <div>
        <label class="block text-xs font-bold uppercase text-gray-500 mb-2 italic"
          >Start Date</label
        >
        <input
          type="date"
          [min]="minDate"
          formControlName="leaseStartDate"
          [ngClass]="{
            'border-red-500':
              rentForm.get('leaseStartDate')?.invalid && rentForm.get('leaseStartDate')?.touched
          }"
          class="w-full border-2 border-gray-100 rounded-xl px-4 py-2.5 focus:border-blue-500 outline-none transition"
        />
        <div class="text-red-500 text-[10px] mt-1 h-3">
          <p
            *ngIf="rentForm.get('leaseStartDate')?.errors?.['required'] && rentForm.get('leaseStartDate')?.touched"
          >
            Start date is required.
          </p>
          <p *ngIf="rentForm.get('leaseStartDate')?.errors?.['pastDate']">
            Date cannot be in the past.
          </p>
        </div>
      </div>

      <div>
        <label class="block text-xs font-bold uppercase text-gray-500 mb-2 italic">End Date</label>
        <input
          type="date"
          [min]="minDate"
          formControlName="leaseEndDate"
          [ngClass]="{
            'border-red-500': 
              (rentForm.get('leaseEndDate')?.invalid || rentForm.errors?.['dateOrderInvalid']) && 
              rentForm.get('leaseEndDate')?.touched
          }"
          class="w-full border-2 border-gray-100 rounded-xl px-4 py-2.5 focus:border-blue-500 outline-none transition"
        />
        <div class="text-red-500 text-[10px] mt-1 h-3">
          <p
            *ngIf="rentForm.get('leaseEndDate')?.errors?.['required'] && rentForm.get('leaseEndDate')?.touched"
          >
            End date is required.
          </p>
        </div>
      </div>
    </div>

    <p
      *ngIf="rentForm.errors?.['dateOrderInvalid'] && (rentForm.get('leaseEndDate')?.touched || rentForm.get('leaseStartDate')?.touched)"
      class="text-red-500 text-xs font-bold text-center bg-red-50 p-2 rounded-lg border border-red-100"
    >
      End date must be at least one day after start date.
    </p>

    <div>
      <label class="block text-xs font-bold uppercase text-gray-500 mb-2 italic"
        >Insurance Plan</label
      >
      <select
        formControlName="insuranceId"
        [ngClass]="{
          'border-red-500':
            rentForm.get('insuranceId')?.invalid && rentForm.get('insuranceId')?.touched
        }"
        class="w-full border-2 border-gray-100 rounded-xl px-4 py-3 focus:border-blue-500 outline-none transition appearance-none bg-white cursor-pointer"
      >
        <option value="" disabled selected>Choose a plan...</option>
        <option *ngFor="let ins of insurances()" [value]="ins.id">
          {{ ins.name }} (+{{ ins.pricePerDay }} din/day)
        </option>
      </select>
      <p
        *ngIf="rentForm.get('insuranceId')?.errors?.['required'] && rentForm.get('insuranceId')?.touched"
        class="text-red-500 text-[10px] mt-1"
      >
        Please select an insurance plan.
      </p>
    </div>

    <div
      class="p-4 bg-gray-50 rounded-xl border border-dashed border-gray-300 space-y-2"
      *ngIf="calculateDays() > 0 && rentForm.valid"
    >
      <div class="flex justify-between text-sm">
        <span class="text-gray-500">Duration:</span>
        <span class="font-bold text-gray-700">{{ calculateDays() }} day(s)</span>
      </div>
      <div class="flex justify-between mt-2 font-bold text-blue-700 border-t pt-2 text-lg">
        <span>Total Price:</span>
        <span>{{ calculateTotal() }} din</span>
      </div>
    </div>

    <div class="flex space-x-3 pt-2">
      <button
        type="button"
        (click)="cancel()"
        class="flex-1 py-3 font-bold text-gray-400 hover:text-gray-600 transition"
      >
        Cancel
      </button>
      <button
        type="submit"
        [disabled]="rentForm.invalid"
        class="flex-2 bg-blue-600 text-white py-4 rounded-2xl font-bold hover:bg-blue-700 disabled:opacity-50 disabled:bg-gray-400 transition shadow-xl shadow-blue-100"
      >
        Confirm and Pay
      </button>
    </div>
  </form>
</div>
